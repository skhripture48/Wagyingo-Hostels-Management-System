<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Wagyingo Hostels Admin Dashboard">
    <title>Admin Dashboard - Wagyingo Hostels</title>
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/admin-dashboard.css" rel="stylesheet">
    
    <!-- Preload critical assets -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" as="script">
    <link rel="preload" href="/admin-dashboard.js" as="script">
</head>
<body>
    <!-- Mobile menu toggle button -->
    <button class="navbar-toggler d-md-none" type="button" onclick="toggleSidebar()" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Mobile menu close button -->
    <button class="btn-close d-md-none" onclick="toggleSidebar()" aria-label="Close menu">
        <i class="fas fa-times"></i>
    </button>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <h4 class="mb-4">Admin Dashboard</h4>
                <div class="nav flex-column">
                    <a class="nav-link active" href="#" data-section="bookings">
                        <i class="bi bi-calendar-check me-2"></i>Bookings
                    </a>
                    <a class="nav-link" href="#" data-section="rooms">
                        <i class="bi bi-house-door me-2"></i>Rooms
                    </a>
                    <a class="nav-link" href="#" data-section="users">
                        <i class="bi bi-people me-2"></i>Users
                    </a>
                    <a class="nav-link" href="#" data-section="payments">
                        <i class="bi bi-credit-card me-2"></i>Payments
                        <span class="badge bg-warning" id="pendingPaymentsCount">0</span>
                    </a>
                    <a class="nav-link" href="#" data-section="residents-portal">
                        <i class="bi bi-house-heart me-2"></i>Residents Portal
                    </a>
                    <a class="nav-link" href="#" id="logoutBtn">
                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 ms-sm-auto px-md-4 main-content">
                <!-- Bookings Section -->
                <div id="bookingsSection" class="section d-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Manage Bookings</h2>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary" data-status="all">All <span class="badge bg-secondary ms-1">0</span></button>
                            <button type="button" class="btn btn-outline-warning" data-status="pending">Pending <span class="badge bg-secondary ms-1">0</span></button>
                            <button type="button" class="btn btn-outline-success" data-status="approved">Approved <span class="badge bg-secondary ms-1">0</span></button>
                            <button type="button" class="btn btn-outline-danger" data-status="cancelled">Cancelled <span class="badge bg-secondary ms-1">0</span></button>
                        </div>
                    </div>
                    
                    <!-- Booking Filters -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Filter by Hostel</label>
                                        <select class="form-select" id="bookingHostelFilter">
                                            <option value="">All Hostels</option>
                                            <option value="Wagyingo Main Hostel">Wagyingo Main Hostel</option>
                                            <option value="Wagyingo Onyx Hostel">Wagyingo Onyx Hostel</option>
                                            <option value="Wagyingo Opal Hostel">Wagyingo Opal Hostel</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Filter by Status</label>
                                        <select class="form-select" id="bookingStatusFilter">
                                            <option value="">All Statuses</option>
                                            <option value="pending">Pending</option>
                                            <option value="approved">Approved</option>
                                            <option value="cancelled">Cancelled</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Search Bookings</label>
                                        <input type="text" class="form-control" id="bookingSearch" placeholder="Search by name, room, or hostel...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bookings Table -->
                    <div class="table-responsive">
                        <table class="table table-striped" id="bookingsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Student Name</th>
                                    <th>Room Number</th>
                                    <th>Hostel</th>
                                    <th>Room Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTableBody">
                                <!-- Bookings will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Rooms Section -->
                <div id="roomsSection" class="section d-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Manage Rooms</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRoomModal">
                            <i class="bi bi-plus-circle me-2"></i>Add Room
                        </button>
                    </div>
                    
                    <!-- Room Filters -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Filter by Hostel</label>
                                        <select class="form-select" id="hostelFilter">
                                            <option value="">All Hostels</option>
                                            <option value="Wagyingo Main Hostel">Wagyingo Main Hostel</option>
                                            <option value="Wagyingo Onyx Hostel">Wagyingo Onyx Hostel</option>
                                            <option value="Wagyingo Opal Hostel">Wagyingo Opal Hostel</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Filter by Room Type</label>
                                        <select class="form-select" id="roomTypeFilter">
                                            <option value="">All Types</option>
                                            <option value="single">Single</option>
                                            <option value="double">Double</option>
                                            <option value="triple">Triple</option>
                                            <option value="quad">Quad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Filter by Status</label>
                                        <select class="form-select" id="statusFilter">
                                            <option value="">All Status</option>
                                            <option value="available">Available</option>
                                            <option value="partially_occupied">Partially Occupied</option>
                                            <option value="fully_occupied">Fully Occupied</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="mb-3">
                            <input type="text" class="form-control" id="roomSearch" placeholder="Search rooms by number, hostel, or type...">
                        </div>
                        <table class="table" id="roomsTable">
                            <thead>
                                <tr>
                                    <th>Room Number</th>
                                    <th>Hostel</th>
                                    <th>Type</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="roomsTableBody">
                                <!-- Rooms will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="usersSection" class="section d-none">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Manage Users</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                            <i class="bi bi-plus"></i> Add User
                        </button>
                    </div>

                    <!-- Hostel Filter Buttons -->
                    <div class="mb-3">
                        <h5>Filter by Hostel</h5>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary active" data-hostel="all">All Hostels</button>
                            <button type="button" class="btn btn-outline-primary" data-hostel="Wagyingo Main Hostel">Main</button>
                            <button type="button" class="btn btn-outline-primary" data-hostel="Wagyingo Onyx Hostel">Onyx</button>
                            <button type="button" class="btn btn-outline-primary" data-hostel="Wagyingo Opal Hostel">Opal</button>
                        </div>
                    </div>

                    <!-- Search and Verification Filter -->
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" id="userSearch" class="form-control" placeholder="Search by name, email...">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    Search In
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item active" href="#" data-search-field="all">All Fields</a></li>
                                    <li><a class="dropdown-item" href="#" data-search-field="name">Name</a></li>
                                    <li><a class="dropdown-item" href="#" data-search-field="email">Email</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <select id="verificationFilter" class="form-select">
                                <option value="all">All Verification Status</option>
                                <option value="verified">Verified Only</option>
                                <option value="unverified">Unverified Only</option>
                            </select>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table id="usersTable" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Preferred Hostel</th>
                                    <th>Status</th>
                                    <th>Email Verified</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Payments Section -->
                <div id="paymentsSection" class="section d-none">
                    <h2>Payments</h2>
                    
                    <!-- Payment Status Filter -->
                    <div class="mb-3">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary active" data-payment-status="all">All</button>
                            <button type="button" class="btn btn-outline-warning" data-payment-status="pending">Pending</button>
                            <button type="button" class="btn btn-outline-success" data-payment-status="paid">Paid</button>
                            <button type="button" class="btn btn-outline-danger" data-payment-status="rejected">Rejected</button>
                        </div>
                    </div>

                    <!-- Hostel Filter -->
                    <div class="mb-3">
                        <h5>Filter by Hostel</h5>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary active" data-payment-hostel="all">All Hostels</button>
                            <button type="button" class="btn btn-outline-primary" data-payment-hostel="Wagyingo Main Hostel">Main</button>
                            <button type="button" class="btn btn-outline-primary" data-payment-hostel="Wagyingo Onyx Hostel">Onyx</button>
                            <button type="button" class="btn btn-outline-primary" data-payment-hostel="Wagyingo Opal Hostel">Opal</button>
                        </div>
                    </div>

                    <!-- Search Box -->
                    <div class="mb-3">
                        <input type="text" class="form-control" id="paymentSearch" placeholder="Search payments...">
                    </div>

                    <div class="table-responsive">
                        <table class="table" id="paymentsTable">
                            <thead>
                                <tr>
                                    <th>Payment ID</th>
                                    <th>Booking ID</th>
                                    <th>Student Name</th>
                                    <th>Room</th>
                                    <th>Hostel</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th style="min-width: 200px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Payments will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Residents Portal Section -->
                <div id="residents-portalSection" class="section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Residents Portal Management</h2>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary" data-tab="maintenance">Maintenance</button>
                            <button class="btn btn-outline-primary" data-tab="announcements">Announcements</button>
                            <button class="btn btn-outline-primary" data-tab="community">Community</button>
                        </div>
                    </div>
                    
                    <!-- Maintenance Requests Tab -->
                    <div id="maintenanceTab" class="tab-content active">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3>Maintenance Requests</h3>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMaintenanceRequestModal">
                                <i class="bi bi-plus-circle"></i> Add Request
                            </button>
                        </div>
                        <div class="table-container">
                            <div class="mb-3">
                                <input type="text" class="form-control" id="maintenanceSearch" placeholder="Search maintenance requests...">
                            </div>
                            <table id="maintenanceTable" class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Student</th>
                                        <th>Room</th>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="maintenanceTableBody">
                                    <!-- Maintenance rows will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Announcements Tab -->
                    <div id="announcementsTab" class="tab-content">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3>Announcements</h3>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAnnouncementModal">
                                <i class="bi bi-plus-circle"></i> Add Announcement
                            </button>
                        </div>
                        <div class="table-container">
                            <div class="mb-3">
                                <input type="text" class="form-control" id="announcementSearch" placeholder="Search announcements...">
                            </div>
                            <table id="announcementsTable" class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Content</th>
                                        <th>Hostel</th>
                                        <th>Priority</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="announcementsTableBody">
                                    <!-- Announcement rows will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Community Tab -->
                    <div id="communityTab" class="tab-content">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3>Community Management</h3>
                        </div>
                        
                        <!-- Community Events Section -->
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4>Community Events</h4>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEventModal">
                                    <i class="bi bi-plus-circle"></i> Add Event
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="eventSearch" placeholder="Search events...">
                                </div>
                                <div class="table-container">
                                    <table id="eventsTable" class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Title</th>
                                                <th>Description</th>
                                                <th>Hostel</th>
                                                <th>Location</th>
                                                <th>Capacity</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="eventsTableBody">
                                            <!-- Event rows will be added here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chat Management Section -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4>Chat Management</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- Message Retention -->
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h5 class="mb-0">Message Retention</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="form-group mb-4">
                                                <label for="retentionPeriod">Retention Period (hours)</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="retentionPeriod" min="1" step="1">
                                                    <div class="input-group-append">
                                                        <button class="btn btn-primary" type="button" id="updateRetention">Update</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Clear Chat Data -->
                                    <div class="form-group mb-4">
                                        <h6>Clear Chat Data</h6>
                                        <p class="text-muted">This will permanently delete all chat messages and uploaded files.</p>
                                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#clearChatModal">
                                            Clear All Chat Data
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Backup Settings -->
                                <div class="col-md-6">
                                    <h5>Backup Settings</h5>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="backupEnabled" checked>
                                        <label class="form-check-label" for="backupEnabled">
                                            Enable automatic backups
                                        </label>
                                    </div>
                                    <button class="btn btn-secondary" id="createBackup">Create Backup Now</button>
                                </div>
                            </div>
                            
                            <!-- Backup History -->
                            <div class="mt-4">
                                <h5>Backup History</h5>
                                <div class="table-container">
                                    <table class="table" id="backupHistoryTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Size</th>
                                                <th>Messages</th>
                                                <th>Files</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Backup history will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Receipt Modal -->
                <div class="modal fade" id="receiptModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Payment Receipt</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="receipt-info mb-3">
                                    <p>Payment Method: <span id="paymentMethodDisplay"></span></p>
                                    <p>Upload Date: <span id="uploadDateDisplay"></span></p>
                                    <p>Status: <span id="paymentStatusDisplay" class="badge"></span></p>
                                </div>
                                <div class="receipt-preview">
                                    <img id="receiptImage" style="max-width: 100%; display: none;">
                                    <iframe id="receiptPdf" style="width: 100%; height: 500px; display: none;"></iframe>
                                </div>
                                <div id="paymentActions" class="mt-3">
                                    <!-- Action buttons will be added here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Room Modal -->
    <div class="modal fade" id="addRoomModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addRoomForm">
                        <div class="mb-3">
                            <label class="form-label">Room Number</label>
                            <input type="text" class="form-control" name="room_number" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Hostel Name</label>
                            <select class="form-select" name="hostel_name" required>
                                <option value="">Select Hostel</option>
                                <option value="Wagyingo Main Hostel">Wagyingo Main Hostel</option>
                                <option value="Wagyingo Onyx Hostel">Wagyingo Onyx Hostel</option>
                                <option value="Wagyingo Opal Hostel">Wagyingo Opal Hostel</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Room Type</label>
                            <select class="form-select" name="room_type" required>
                                <option value="single">Single</option>
                                <option value="double">Double</option>
                                <option value="triple">Triple</option>
                                <option value="quad">Quad</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Price (GHS)</label>
                            <input type="number" class="form-control" name="price" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="addRoomForm" class="btn btn-primary">Add Room</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" name="full_name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" name="password" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" name="role" required>
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="addUserForm" class="btn btn-primary">Add User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Maintenance Request Modal -->
    <div class="modal fade" id="addMaintenanceRequestModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Maintenance Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addMaintenanceRequestForm">
                        <div class="mb-3">
                            <label for="maintenanceStudent" class="form-label">Student</label>
                            <select class="form-select" id="maintenanceStudent" required>
                                <option value="">Select a student</option>
                                <!-- Students will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="maintenanceTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="maintenanceTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="maintenanceCategory" class="form-label">Category</label>
                            <select class="form-select" id="maintenanceCategory" required>
                                <option value="">Select a category</option>
                                <option value="plumbing">Plumbing</option>
                                <option value="electrical">Electrical</option>
                                <option value="furniture">Furniture</option>
                                <option value="appliance">Appliance</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="maintenancePriority" class="form-label">Priority</label>
                            <select class="form-select" id="maintenancePriority" required>
                                <option value="">Select priority</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="maintenanceDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="maintenanceDescription" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitMaintenanceRequest">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Announcement Modal -->
    <div class="modal fade" id="addAnnouncementModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addAnnouncementForm">
                        <div class="mb-3">
                            <label for="announcementTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="announcementTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="announcementContent" class="form-label">Content</label>
                            <textarea class="form-control" id="announcementContent" rows="4" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="announcementHostel" class="form-label">Hostel</label>
                            <select class="form-select" id="announcementHostel" required>
                                <option value="">Select a hostel</option>
                                <option value="all">All Hostels</option>
                                <option value="Wagyingo Main Hostel">Wagyingo Main Hostel</option>
                                <option value="Wagyingo Onyx Hostel">Wagyingo Onyx Hostel</option>
                                <option value="Wagyingo Opal Hostel">Wagyingo Opal Hostel</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="announcementPriority" class="form-label">Priority</label>
                            <select class="form-select" id="announcementPriority" required>
                                <option value="">Select priority</option>
                                <option value="normal">Normal</option>
                                <option value="important">Important</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="announcementStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="announcementStartDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="announcementEndDate" class="form-label">End Date (Optional)</label>
                                <input type="date" class="form-control" id="announcementEndDate">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitAnnouncement">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Community Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Community Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addEventForm">
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="eventDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="eventHostel" class="form-label">Hostel</label>
                            <select class="form-select" id="eventHostel" required>
                                <option value="">Select a hostel</option>
                                <option value="all">All Hostels</option>
                                <option value="Wagyingo Main Hostel">Wagyingo Main Hostel</option>
                                <option value="Wagyingo Onyx Hostel">Wagyingo Onyx Hostel</option>
                                <option value="Wagyingo Opal Hostel">Wagyingo Opal Hostel</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="eventDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="eventDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="eventTime" class="form-label">Time</label>
                                <input type="time" class="form-control" id="eventTime" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="eventLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="eventLocation" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventCapacity" class="form-label">Capacity</label>
                            <input type="number" class="form-control" id="eventCapacity" min="1" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitEvent">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Room Modal -->
    <div class="modal fade" id="editRoomModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editRoomForm">
                        <div class="mb-3">
                            <label class="form-label">Room Number</label>
                            <input type="text" class="form-control" name="room_number" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Hostel Name</label>
                            <select class="form-select" name="hostel_name" required>
                                <option value="">Select Hostel</option>
                                <option value="Wagyingo Main Hostel">Wagyingo Main Hostel</option>
                                <option value="Wagyingo Onyx Hostel">Wagyingo Onyx Hostel</option>
                                <option value="Wagyingo Opal Hostel">Wagyingo Opal Hostel</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Room Type</label>
                            <select class="form-select" name="room_type" required>
                                <option value="double">Double</option>
                                <option value="triple">Triple</option>
                                <option value="quad">Quad</option>
                                <option value="single">Single</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Price</label>
                            <input type="number" class="form-control" name="price" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status" required>
                                <option value="available">Available</option>
                                <option value="partially_occupied">Partially Occupied</option>
                                <option value="fully_occupied">Fully Occupied</option>
                            </select>
                        </div>
                        <div class="mb-3" id="genderOccupancyField">
                            <label class="form-label">Gender Occupancy</label>
                            <select class="form-select" name="gender_occupancy">
                                <option value="">Not Set</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                            <small class="form-text text-muted">Only applicable for partially occupied or fully occupied rooms</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveRoomChanges()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Clear Chat Confirmation Modal -->
    <div class="modal fade" id="clearChatModal" tabindex="-1" role="dialog" aria-labelledby="clearChatModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clearChatModalLabel">Confirm Clear Chat Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>Warning:</strong> This action cannot be undone!
                    </div>
                    <p>This will permanently delete:</p>
                    <ul>
                        <li>All chat messages</li>
                        <li>All uploaded files</li>
                        <li>All message history</li>
                    </ul>
                    <p>Are you sure you want to proceed?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmClearChat" onclick="clearAllChatData(event)">
                        Yes, Clear All Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="/admin-dashboard.js" defer></script>
    <script>
        // Service worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    // Unregister existing service workers
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for(let registration of registrations) {
                        await registration.unregister();
                    }

                    // Register new service worker
                    const registration = await navigator.serviceWorker.register('/service-worker.js');
                    console.log('ServiceWorker registration successful');

                    // Wait for service worker to be ready
                    await navigator.serviceWorker.ready;
                    console.log('ServiceWorker is ready');

                    // Check for existing subscription
                    let subscription = await registration.pushManager.getSubscription();
                    
                    if (!subscription) {
                        // Create new subscription
                        const vapidPublicKey = 'BPH_bYeETv82wTTnOSsBJ69_rxSELuBq_i8vVvIumpnYR0KTRVOeuAjg6riPtU299SBTy5BE2TYkQ1gMNb7x_hM';
                        const convertedVapidKey = urlBase64ToUint8Array(vapidPublicKey);
                        
                        subscription = await registration.pushManager.subscribe({
                            userVisibleOnly: true,
                            applicationServerKey: convertedVapidKey
                        });
                    }

                    // Send subscription to server
                    await fetch('/api/notifications/subscribe', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            subscription: subscription,
                            role: 'admin'
                        }),
                        credentials: 'include'
                    });

                } catch (err) {
                    console.error('ServiceWorker registration failed:', err);
                }
            });
        }

        // Mobile menu functions
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const closeBtn = document.querySelector('.btn-close');
            const toggleBtn = document.querySelector('.navbar-toggler');
            
            sidebar.classList.toggle('show');
            closeBtn.style.display = sidebar.classList.contains('show') ? 'block' : 'none';
            toggleBtn.style.display = sidebar.classList.contains('show') ? 'none' : 'block';
        }
        
        // Close sidebar when clicking outside
        document.addEventListener('click', function(event) {
            const sidebar = document.querySelector('.sidebar');
            const toggleBtn = document.querySelector('.navbar-toggler');
            const closeBtn = document.querySelector('.btn-close');
            
            if (window.innerWidth < 768 && 
                !sidebar.contains(event.target) && 
                !toggleBtn.contains(event.target) &&
                !closeBtn.contains(event.target)) {
                sidebar.classList.remove('show');
                closeBtn.style.display = 'none';
                toggleBtn.style.display = 'block';
            }
        });

        // Close sidebar when clicking nav links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth < 768) {
                    toggleSidebar();
                }
            });
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.querySelector('.sidebar');
            const closeBtn = document.querySelector('.btn-close');
            const toggleBtn = document.querySelector('.navbar-toggler');
            
            if (window.innerWidth >= 768) {
                sidebar.classList.remove('show');
                closeBtn.style.display = 'none';
                toggleBtn.style.display = 'none';
            } else {
                toggleBtn.style.display = sidebar.classList.contains('show') ? 'none' : 'block';
            }
        });
    </script>
</body>
</html> 